---
layout: blog
title: 我为什么写单元测试
---

本文主旨：举几个例子，说明我眼里的单元测试
1.验证程序的正确性
这也许是最废话的功能，发现你漏写了逻辑、写错了变量之类的bug
2.方法接口的说明书
很多开源框架的Doc很粗略，例如淘宝温少的代码几乎没有注释。虽然“代码就是最好的注释”，但是代码无法让人很快宏观上了解一段代码。对于这种注释稀缺的源码，很好的单元测试就是它的说明书。
你可以看到一个方法接收什么样的参数，也可以通过断言看出来返回了什么结果。
精心设计的异常测试，可以很明确的告诉你不能怎样。
即便是注释良好的代码，配上单元测试的表达，会更快让人上手。
3.提高信心
你平常一直在写单元测试，对于提高信心的效果不大，但是当你的项目经常重构的时候，你将会对你的重构很有信心。
假设你没有UTC(unit test case)，你修改了一个非常底层，公用性很强的模块。你完成了，但是为了确定这个重构有效果的同时没有带来Bug，你必须测试所有的地方，这个也许是由你自己做或者是由QA的同事帮你完成。你不知道这个修改会影响到多少地方，是否真的影响了，影响了什么，只能四处寻找，生怕自己错过什么。
但是，有了很全面的UTC，你做了同样的修改。你发现你并没有减少工作量，因为你或者你的同事还得做全面的测试。但是，不同的是你很有信心，因为你的单元测试全过了，没过的单元测试就像一个警钟一样告诉你“你错了”，你修复的同时会让你更深入的思考你的重构哪里没有考虑周全。一个过了的单元测试，用了几秒告诉了你“你的重构并没有影响到我，请放心”。
如果你有了信心，你才会更积极的去重构。
4.发现别人的问题
有一次，我写的单元测试挂了，让我很诧异。最后发现存入数据库DDL将一个字段的小数点后位数设置为了0位，浮点数全部被转为了整形。
我发现了一个数据团队的一个失误。
5.合作开发
你往往对自己的代码很有信心，我认为这是一种错觉。姑且你真的是一个不会出错的人，但是，你不能保证多个人的代码集成到一起的时候不会互相影响。
单元测试，用很短的时间，就会告诉你集成后是否有影响，一个明确的结果（green bar），而不是让你猜测回想。
6.让你的代码变的更全面
写单元测试的过程，就是要想办法把你的代码搞挂的过程。自己和自己的较量。这个时候你会发现你的代码不够强壮，没准一个null就会让它惨不忍睹。
7.证明Bug并未重现
每当出现一个bug，不要着急修复它，而是用UTC重现它，搞红它。用代码证明你错了，然后修复它，用代码证明你改正了。以后的每一次重跑，都是在暗示，之前的bug没有重现。